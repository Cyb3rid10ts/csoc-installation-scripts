This document contains how Canary log information is structured along with sample data and GROK parser patterns for use with Apache Metron.  

See http://grokconstructor.appspot.com/ and http://grokconstructor.appspot.com/do/match#result for GROK related tools (i.e. pattern verifier) to verirfy GROK statements that are used to parse the log information.


<h3>Log/Alert Generator: GCRdionaeaAlerts.py</h3>
Location of log file: ./var/log/dionaea/GCRDionaea.log<br />
<br />
<h5>*What each column means:*</h5>
<table><tr><td>
UnixTime | alert_type | hostname | event | connection_id | ip_dst_add | dst_port | ip_src_addr | src_port | payload |
</td></tr></table>

<h5>GROK STATEMENT</h5>
<table><tr><td>
%{NUMBER:timestamp}\|%{GREEDYDATA:alert_type}\|%{GREEDYDATA:hostname}\|%{GREEDYDATA:event}\|%{NUMBER:connection_id}\|%{IP:ip_dst_addr}\|%{NUMBER:dst_port}\|%{IP:ip_src_addr}\|%{NUMBER:src_port}\|%{GREEDYDATA:payload}\|
</td></tr></table>

<h5>SAMPLE OF LOG:</h5>
<table><tr><td>
1505872111|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,Blackhole)-Alert(connections)|141208|10.2.1.110|23|10.2.1.46|47394|[CONNECTIONS:(connection       connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(141208        accept  tcp     Blackhole       1505872111.5190728      141208  None    10.2.1.110      23      10.2.1.46               47394)]|<br />
1505872112|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,httpd)-Alert(connections)|141211|10.2.1.110|80|10.2.1.46|42915|[CONNECTIONS:(connection    connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(141211        accept  tcp     httpd   1505872111.947919       141211  None    10.2.1.110      80      10.2.1.46               42915)]|<br />
1505872113|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,mysqld)-Alert(mysql_commands,logins,connections)|141210|10.2.1.110|3306|10.2.1.46|52086|[CONNECTIONS:(connection   connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(141210        accept  tcp     mysqld  1505872111.849848       141210  None    10.2.1.110      3306    10.2.1.46               52086)][LOGINS:(login   connection      login_username  login_password  )(192   141210  b'htr'  )][MYSQL_COMMANDS:(mysql_command        connection      mysql_command_cmd       )(10    141210  3       [MYSQL_COMMAND_ARGS:(mysql_command_arg  mysql_command   mysql_command_arg_index mysql_command_arg_data  )(10    10      0       show databases)][MYSQL_COMMAND_OPS:(mysql_command_op    mysql_command_cmd       mysql_command_op_name   )(4     3       COM_QUERY))]|<br />
1505871634|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,mqttd)-Alert(mqtt_subscribe_commands,mqtt_fingerprints,connections)|136556|10.2.1.110|1883|10.2.1.46|48046|[CONNECTIONS:(connection       connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(136556        accept  tcp     mqttd   1505871635.7230175      136556  None    10.2.1.110      1883    10.2.1.46               48046)][MQTT_FINGERPRINTS:(mqtt_fingerprint     connection      mqtt_fingerprint_clientid       mqtt_fingerprint_willtopic      mqtt_fingerprint_willmessage    mqtt_fingerprint_username       mqtt_fingerprint_password       )(32    136556  b'apNSJAWKEOLLQEEXXQ'   b''     b''     b''     b'')][MQTT_SUBSCRIBE_COMMANDS:(mqtt_subscribe_command   connection      mqtt_subscribe_command_messageid        mqtt_subscribe_command_topic    )(33    136556  2       b'$SYS/#')]|<br />
1505870685|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,mqttd)-Alert(mqtt_publish_commands,connections)|126672|10.2.1.110|1883|10.2.1.46|59683|[CONNECTIONS:(connection   connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(126672        accept  tcp     mqttd   1505870687.2091851      126672  None    10.2.1.110      1883    10.2.1.46               59683)][MQTT_PUBLISH_COMMANDS:(mqtt_publish_command     connection      mqtt_publish_command_topic      mqtt_publish_command_message    )(66    126672  b''     b'\xc2\xc0\xff\xff\xff\xff\xd4\x07')]|<br />
1505871656|GCRCanary-Device|gcrtech-desktop|Connection(accept,tcp,smbd)-Alert(dcerpcbinds,connections)|136737|10.2.1.110|445|10.2.1.46|52187|[CONNECTIONS:(connection        connection_type connection_transport    connection_protocol     connection_timestamp    connection_root connection_parent       local_host      local_port      remote_host     remote_hostname remote_port     )(136737        accept  tcp     smbd    1505871655.474848       136737  None    10.2.1.110      445     10.2.1.46               52187)][DCERPCBINDS:(dcerpcbind connection      dcerpcbind_uuid dcerpcbind_transfersyntax       )(16    136737  4b324fc8-1670-01d3-1278-5a47bf6ee188    8a885d04-1ceb-11c9-9fe8-08002b104860    [DCERPCSERVICES:(dcerpcservice  dcerpcservice_uuid      dcerpcservice_name      )(22    4b324fc8-1670-01d3-1278-5a47bf6ee188    SRVSVC))]|<br />
 1506982504.000|GCRCanary-Device|privatearchives6|HeartBeat|0|10.2.1.120|0|10.2.1.120|0|TIME OF ALERT:2017-10-02 22:15:04    PROCESS 1 START TIME:2017-10-02 10:13:06    CPU COUNT(4) % usage:CPU0(0.2) CPU1(0.0) CPU2(0.0) CPU3(0.0)     VIRT_MEMORY:svmem(total=970477568, available=682057728, percent=29.7, used=674656256, free=295821312, active=463613952, inactive=154857472, buffers=51523584, cached=334712832)    DISK_USAGE:sdiskusage(total=15481057280, used=4524650496, free=10939629568, percent=29.2)    PUBLIC_IP(207.107.70.174)    LOCAL_IP(10.2.1.120)    DIONAEA_HTTP_CHECK:1|<br />
</td></tr></table>

